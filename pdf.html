<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Conversor Texto → PDF — Dark Glass</title>

  <!-- jsPDF (CDN) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    /* ===== tema escuro + vidro fosco ===== */
    :root{
      --bg-1: #0b0f14;
      --bg-2: #081018;
      --glass-1: rgba(255,255,255,0.04);
      --glass-2: rgba(255,255,255,0.02);
      --accent: #6dd3ff;
      --muted: #99a0ab;
      --text: #e6eef6;
      --radius: 14px;
      --pad: 18px;
      --glass-border: rgba(255,255,255,0.06);
    }

    html,body{height:100%;margin:0;background:linear-gradient(180deg, var(--bg-2) 0%, var(--bg-1) 100%);font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;color:var(--text);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}

    /* centraliza área */
    .page {
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:32px;
      box-sizing:border-box;
    }

    /* card principal com vidro fosco */
    .card {
      width:100%;
      max-width:980px;
      display:grid;
      grid-template-columns: 1fr 360px;
      gap:18px;
      padding:calc(var(--pad) + 6px);
      border-radius:var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border: 1px solid var(--glass-border);
      box-shadow: 0 8px 30px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
      backdrop-filter: blur(10px) saturate(120%);
      -webkit-backdrop-filter: blur(10px) saturate(120%);
    }

    /* fallback para navegadores sem backdrop-filter */
    @supports not ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))) {
      .card { background: linear-gradient(180deg, rgba(8,10,12,0.9), rgba(6,8,10,0.95)); }
    }

    h1 { margin:0 0 8px 0; font-size:18px; color:var(--text); }
    .left { padding:6px 0; }
    label { display:block; font-size:13px; color:var(--muted); margin-top:12px; }
    input[type="text"], input[type="number"], select {
      width:100%;
      padding:9px 10px;
      border-radius:8px;
      background: rgba(10,12,14,0.6);
      border: 1px solid rgba(255,255,255,0.04);
      color:var(--text);
      font-size:13px;
      box-sizing:border-box;
      outline: none;
    }
    .controls { display:flex; gap:8px; align-items:center; margin-top:12px; flex-wrap:wrap; }
    textarea {
      width:100%;
      min-height:460px;
      padding:12px;
      resize:vertical;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.04);
      background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
      color:var(--text);
      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
      font-size:13px;
      line-height:1.5;
      box-sizing:border-box;
    }

    button {
      background: linear-gradient(180deg, rgba(109,211,255,0.16), rgba(109,211,255,0.06));
      color:var(--text);
      border:1px solid rgba(109,211,255,0.12);
      padding:10px 12px;
      border-radius:10px;
      cursor:pointer;
      font-weight:600;
      transition: transform .08s ease, box-shadow .08s;
    }
    button:hover { transform: translateY(-2px); box-shadow: 0 6px 18px rgba(6,20,30,0.45) }
    button.ghost {
      background: transparent;
      border:1px solid rgba(255,255,255,0.04);
      color:var(--muted);
      font-weight:500;
    }

    .right { padding-left:6px; border-left: 1px solid rgba(255,255,255,0.02) }
    .panel { background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:12px; border-radius:10px; border:1px solid rgba(255,255,255,0.02); color:var(--muted) }
    .panel strong { color:var(--text) }
    .field { margin-top:10px; }
    .note { font-size:12px; color:var(--muted); margin-top:8px; display:block }

    /* preview */
    #preview { margin-top:8px; font-size:13px; color:var(--muted); max-height:220px; overflow:auto; white-space:pre-wrap; padding:8px; background: rgba(0,0,0,0.15); border-radius:8px; border:1px solid rgba(255,255,255,0.02) }

    footer.info { margin-top:10px; color:var(--muted); font-size:12px }

    @media (max-width:980px){
      .card { grid-template-columns: 1fr; padding:14px; }
      .right{ border-left: none; padding-left:0; margin-top:8px; }
      textarea { min-height:300px; }
    }
  </style>
</head>
<body>
  <div class="page">
    <main class="card" role="main" aria-label="Conversor texto para PDF">
      <section class="left">
        <h1>Conversor — texto → PDF</h1>

        <label for="titulo">Nome do arquivo (opcional)</label>
        <input id="titulo" type="text" placeholder="meu_documento.pdf" />

        <div style="display:flex;gap:12px;margin-top:10px;">
          <div style="flex:1">
            <label for="fontsize">Tamanho da fonte (pt)</label>
            <input id="fontsize" type="number" min="8" max="28" value="12" />
          </div>
          <div style="width:140px">
            <label for="format">Formato</label>
            <select id="format">
              <option value="a4">A4</option>
              <option value="letter">Letter</option>
              <option value="a5">A5</option>
            </select>
          </div>
        </div>

        <label for="texto" style="margin-top:12px">Texto</label>
        <textarea id="texto" placeholder="Cole ou digite seu texto aqui. Separe parágrafos com linhas em branco."></textarea>

        <div class="controls">
          <button id="gerar">Gerar PDF</button>
          <button class="ghost" id="limpar">Limpar</button>
          <div style="margin-left:auto;color:var(--muted)">Gera PDF no navegador — sem upload.</div>
        </div>

        <footer class="info">Se precisar de suporte a fontes Unicode completas (emoji, ideogramas), eu adiciono a fonte embutida — o arquivo ficará maior.</footer>
      </section>

      <aside class="right" aria-label="Opções">
        <div class="panel">
          <strong>Opções avançadas</strong>

          <div class="field">
            <label for="fontfamily">Fonte</label>
            <select id="fontfamily">
              <option value="times">Times</option>
              <option value="helvetica" selected>Helvetica</option>
              <option value="courier">Courier</option>
            </select>
          </div>

          <div class="field">
            <label for="align">Alinhamento</label>
            <select id="align">
              <option value="left" selected>Esquerda</option>
              <option value="center">Centralizado</option>
              <option value="right">Direita</option>
              <option value="justify">Justificado (aprox.)</option>
            </select>
          </div>

          <div class="field">
            <label for="margin">Margem (mm)</label>
            <input id="margin" type="number" min="6" max="40" value="15" />
          </div>

          <div class="field">
            <label for="pagenumbers">Número de página</label>
            <select id="pagenumbers">
              <option value="no" selected>Não</option>
              <option value="bottom">Rodapé (centro)</option>
              <option value="top">Cabeçalho (direita)</option>
            </select>
          </div>

          <div style="display:flex;gap:8px;margin-top:12px">
            <button id="baixar">Gerar e baixar</button>
            <button class="ghost" id="copiar">Copiar texto</button>
          </div>

          <div class="field">
            <small class="note">O conversor transforma parágrafos separados por linha em branco. Quebras internas de linha são convertidas em espaço no parágrafo.</small>
          </div>
        </div>

        <div class="panel" style="margin-top:12px">
          <strong>Pré-visualização</strong>
          <div id="preview"></div>
          <small class="note">Mostra os primeiros 1000 caracteres do texto.</small>
        </div>
      </aside>
    </main>
  </div>

  <script>
    (function () {
      const { jsPDF } = window.jspdf;

      const el = {
        texto: document.getElementById('texto'),
        gerar: document.getElementById('gerar'),
        limpar: document.getElementById('limpar'),
        titulo: document.getElementById('titulo'),
        fontsize: document.getElementById('fontsize'),
        format: document.getElementById('format'),
        fontfamily: document.getElementById('fontfamily'),
        align: document.getElementById('align'),
        margin: document.getElementById('margin'),
        pagenumbers: document.getElementById('pagenumbers'),
        baixar: document.getElementById('baixar'),
        copiar: document.getElementById('copiar'),
        preview: document.getElementById('preview')
      };

      function atualizaPreview() {
        const t = el.texto.value || '';
        el.preview.textContent = t.slice(0, 1000) + (t.length > 1000 ? '\n\n... (restante oculto)' : '');
      }
      el.texto.addEventListener('input', atualizaPreview);
      atualizaPreview();

      el.limpar.addEventListener('click', () => {
        el.texto.value = '';
        atualizaPreview();
      });

      el.copiar.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(el.texto.value || '');
          alert('Texto copiado para a área de transferência.');
        } catch (e) {
          alert('Não foi possível copiar automaticamente. Selecione e copie manualmente.');
        }
      });

      function sanitizeFilename(name) {
        if (!name) return 'documento.pdf';
        let s = name.trim();
        // adiciona extensão se necessário
        if (!/\.[a-zA-Z0-9]{1,5}$/.test(s)) s += '.pdf';
        return s.replace(/[^\w\-\.çÇãÃáÁàÀéÉíÍóÓúÚüÜõÕ ]/g, '_').replace(/\s+/g, '_');
      }

      function ptToMm(pt){ return pt * 0.3527777778; } // 1pt = 0.3527777778 mm

      // Gera PDF (retorna true se gerou)
      function gerarPDF(filenameOverride) {
        const raw = el.texto.value || '';
        if (!raw.trim()) { alert('Insira algum texto antes de gerar o PDF.'); return false; }

        const fontSize = Number(el.fontsize.value) || 12;
        const format = el.format.value || 'a4';
        const font = el.fontfamily.value || 'helvetica';
        const align = el.align.value || 'left';
        const margin = Number(el.margin.value) || 15;
        const pageNumbers = el.pagenumbers.value || 'no';

        const filename = sanitizeFilename(filenameOverride || el.titulo.value);

        const doc = new jsPDF({ unit: 'mm', format: format, putOnlyUsedFonts: true, floatPrecision: 16 });
        const pageWidth = doc.internal.pageSize.getWidth();
        const pageHeight = doc.internal.pageSize.getHeight();
        const usableWidth = pageWidth - margin * 2;

        doc.setFont(font);
        doc.setFontSize(fontSize);

        // transformar em paragráfos (separados por linha em branco)
        const paragraphs = raw.split(/\r?\n\s*\r?\n/).map(p => p.replace(/\r?\n/g, ' ').trim());

        const lineHeight = ptToMm(fontSize) * 1.25;
        let cursorY = margin + ptToMm(fontSize);

        // função para adicionar nova página quando necessário
        function ensurePageSpace(needed) {
          if (cursorY + needed > pageHeight - margin) {
            doc.addPage();
            cursorY = margin + ptToMm(fontSize);
          }
        }

        // para contar total de páginas quando usar numeração, geramos e depois adicionamos numeração
        // estratégia simples: gerar conteúdo em páginas, lembrando posições para numerar depois
        const pageCountBefore = doc.getNumberOfPages ? doc.getNumberOfPages() : 1;

        for (let p = 0; p < paragraphs.length; p++) {
          const paragraph = paragraphs[p];
          if (!paragraph) {
            cursorY += lineHeight;
            continue;
          }
          const lines = doc.splitTextToSize(paragraph, usableWidth);
          for (let i = 0; i < lines.length; i++) {
            ensurePageSpace(lineHeight);
            // alinhamento
            if (align === 'center' || align === 'right') {
              // usar opções de jsPDF para alinhamento com maxWidth
              doc.text(String(lines[i]), margin + usableWidth / 2, cursorY, { maxWidth: usableWidth, align: align });
            } else if (align === 'justify') {
              // jsPDF não tem justify nativo para text(); aproximamos com left
              doc.text(String(lines[i]), margin, cursorY, { maxWidth: usableWidth });
            } else {
              doc.text(String(lines[i]), margin, cursorY, { maxWidth: usableWidth });
            }
            cursorY += lineHeight;
          }
          cursorY += lineHeight * 0.45; // espaço entre parágrafos
        }

        // número de páginas: adicionar em cada página se pedido
        if (pageNumbers !== 'no') {
          const total = doc.getNumberOfPages();
          // percorre páginas e adiciona numeração
          for (let i = 1; i <= total; i++) {
            doc.setPage(i);
            doc.setFontSize(Math.max(8, fontSize - 2));
            const text = `${i} / ${total}`;
            if (pageNumbers === 'bottom') {
              doc.text(text, pageWidth / 2, pageHeight - margin / 2, { align: 'center' });
            } else if (pageNumbers === 'top') {
              doc.text(text, pageWidth - margin, margin / 2 + 2, { align: 'right' });
            }
            doc.setFontSize(fontSize);
          }
        }

        // voltar para a primeira página antes de salvar
        try { doc.setPage(1); } catch(e) { /* ignore */ }
        doc.save(filename);
        return true;
      }

      el.gerar.addEventListener('click', () => gerarPDF());

      el.baixar.addEventListener('click', () => {
        const nome = el.titulo.value.trim();
        gerarPDF(nome || null);
      });

      // também permitir Ctrl+Enter para gerar
      el.texto.addEventListener('keydown', (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
          e.preventDefault();
          gerarPDF();
        }
      });

    })();
  </script>
</body>
</html>
