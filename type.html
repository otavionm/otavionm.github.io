<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Otávio Type — Online Text Editor</title>

<!-- libs -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html-docx-js/0.4.1/html-docx.min.js"></script>
<script src="https://unpkg.com/pdfjs-dist/build/pdf.min.js"></script>

<style>
  /* ===== background gradient (top-right blue -> bottom-left deep purple) ===== */
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial}
  body{
    /* direction: to bottom left means start at top-right */
    background: linear-gradient(to bottom left, #031730 0%, #12001b 100%);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    color: #e6eef6;
  }

  /* shell with stronger glass effect */
  .page { min-height:100vh; display:flex; align-items:flex-start; justify-content:center; padding:28px; box-sizing:border-box; }
  .shell {
    width:100%; max-width:1280px; display:flex; flex-direction:column; gap:10px;
    border-radius:14px; padding:0; position:relative;
    /* stronger frosted glass */
    background: linear-gradient(180deg, rgba(255,255,255,0.045), rgba(255,255,255,0.01));
    border: 1px solid rgba(255,255,255,0.08);
    box-shadow: 0 30px 80px rgba(3,8,20,0.75), inset 0 1px 0 rgba(255,255,255,0.02);
    backdrop-filter: blur(16px) saturate(140%);
    -webkit-backdrop-filter: blur(16px) saturate(140%);
    overflow: visible;
  }

  /* Top fixed area (holds menu + toolbar) */
  .top-fixed {
    position: sticky;
    top: 12px; /* distance from viewport top */
    z-index: 999;
    display:flex;
    flex-direction:column;
    gap:8px;
    padding:12px;
    margin: 12px;
    border-radius:12px;
    /* stronger glass for the fixed area */
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01));
    border: 1px solid rgba(255,255,255,0.12);
    box-shadow: 0 12px 34px rgba(0,0,0,0.45);
    backdrop-filter: blur(18px) saturate(140%);
    -webkit-backdrop-filter: blur(18px) saturate(140%);
  }

  /* appbar */
  .appbar { display:flex; align-items:center; gap:12px; }
  .brand { font-weight:700; font-size:16px; color:#eaf6ff; padding:6px 10px; border-radius:6px; background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));}
  .doc-title { font-weight:600; font-size:15px; color: #dff6ff; padding:6px 8px; border-radius:6px; background:transparent; min-width:220px; outline:none }
  .menu-strip { display:flex; gap:8px; color:#c7d6e1; font-size:13px; }
  .menu-strip button { background:transparent; border:0; color:inherit; cursor:pointer; padding:6px 8px; border-radius:6px }
  .menu-strip button:hover { background: rgba(255,255,255,0.02); color:#fff; }

  /* toolbar */
  .toolbar { display:flex; align-items:center; gap:10px; padding:8px; border-radius:8px; }
  .group { display:flex; gap:6px; align-items:center }
  .btn { background: linear-gradient(180deg, rgba(120,200,255,0.09), rgba(120,200,255,0.03)); border:1px solid rgba(120,200,255,0.09); color: #eaf6ff; padding:8px 10px; border-radius:6px; cursor:pointer; font-weight:600; font-size:13px }
  .btn.ghost { background:transparent; border:1px solid rgba(255,255,255,0.03); color:#c7d6e1; font-weight:500 }
  .small { padding:6px 8px; font-size:13px }
  select, input[type="color"] { background: rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.04); color:#eaf6ff; padding:6px 8px; border-radius:6px; }

  /* workspace / paper */
  .workspace { display:flex; justify-content:center; padding:28px 0; }
  .paper-wrap { width:842px; display:flex; justify-content:center; }
  .paper {
    width:100%; background:#ffffff; color:#111; border-radius:4px; box-shadow:0 12px 36px rgba(0,0,0,0.35);
    padding:32px; box-sizing:border-box; min-height:780px; max-width:100%; overflow:auto;
  }

  /* editor content */
  #editor { min-height:720px; outline:none; font-size:12pt; line-height:1.45; font-family:"Times New Roman", Times, serif; color:inherit; background:transparent; }
  #editor p{margin:0 0 12px}

  /* resizable images */
  .resizable{ display:inline-block; position:relative; border:1px dashed transparent }
  .resizable img{ display:block; max-width:100%; height:auto; cursor:move }
  .resizer-handle{ position:absolute; width:12px; height:12px; right:6px; bottom:6px; background:#64d0ff; border-radius:3px; cursor:se-resize; box-shadow:0 3px 8px rgba(0,0,0,0.45) }

  /* bottom bar */
  .bottom-bar { display:flex; justify-content:space-between; align-items:center; color:#c7d6e1; font-size:13px; padding:10px 18px; }

  /* PDF clone normalization for export */
  .pdf-clone { background:white !important; color:black !important; padding:18mm !important; font-family:"Times New Roman", Times, serif !important; font-size:12pt !important; line-height:1.45 !important; }
  .pdf-clone img{ max-width:100%; height:auto; display:block; margin:8px 0 }

  /* mobile adjustments */
  @media (max-width:1000px){
    .paper-wrap{ width:100%; padding:0 14px }
    .paper{ padding:20px }
    .top-fixed{ margin:8px }
  }
</style>
</head>
<body>
  <div class="page">
    <div class="shell">
      <!-- top fixed menus & toolbar (sticky) -->
      <div class="top-fixed" role="navigation" aria-label="Top controls">
        <div class="appbar">
          <div class="brand">Otávio Type</div>
          <div class="doc-title" id="docTitleDisplay" contenteditable="true" aria-label="Document title">Untitled document</div>
          <nav class="menu-strip" aria-hidden="true">
            <button class="ghost small">File</button>
            <button class="ghost small">Edit</button>
            <button class="ghost small">View</button>
            <button class="ghost small">Insert</button>
            <button class="ghost small">Format</button>
          </nav>

          <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
            <input id="fileOpen" type="file" accept=".txt,.docx,.pdf" style="display:none">
            <button class="btn small" id="openBtn">Open</button>
            <button class="btn small" id="saveTxt">Save .TXT</button>
            <button class="btn small" id="saveDocx">Save .DOCX</button>
            <button class="btn small" id="saveOdt">Save .ODT</button>
            <button class="btn" id="exportPdf">Export PDF</button>
            <button class="btn" id="printBtn">Print</button>
          </div>
        </div>

        <div class="toolbar" role="toolbar" aria-label="Formatting toolbar">
          <div class="group">
            <select id="fontFamily" title="Font family" aria-label="Font family">
              <option value="Times New Roman">Times New Roman</option>
              <option value="Arial">Arial</option>
              <option value="Georgia">Georgia</option>
              <option value="Courier New">Courier New</option>
            </select>
            <select id="fontSize" title="Font size" aria-label="Font size">
              <option value="10">10</option><option value="11">11</option><option value="12" selected>12</option><option value="14">14</option><option value="16">16</option>
            </select>
          </div>

          <div class="group">
            <button class="btn small" id="boldBtn"><strong>B</strong></button>
            <button class="btn small" id="italicBtn"><em>I</em></button>
            <button class="btn small" id="underlineBtn"><u>U</u></button>
            <button class="btn small" id="strikeBtn"><s>S</s></button>
            <input type="color" id="colorPicker" title="Text color" style="width:36px;height:36px;border-radius:6px;padding:2px;border:1px solid rgba(255,255,255,0.04)">
          </div>

          <div class="group">
            <button class="btn small" id="leftAlign">Left</button>
            <button class="btn small" id="centerAlign">Center</button>
            <button class="btn small" id="rightAlign">Right</button>
            <button class="btn small" id="justifyAlign">Justify</button>
          </div>

          <div class="group">
            <button class="btn small" id="bulletList">Bulleted</button>
            <button class="btn small" id="numberList">Numbered</button>
            <button class="btn small" id="indent">Indent</button>
            <button class="btn small" id="outdent">Outdent</button>
          </div>

          <div class="group">
            <button class="btn small" id="linkBtn">Link</button>
            <button class="btn small" id="emailBtn">@</button>
            <button class="btn small" id="imageBtn">Image</button>
            <input id="imageInput" type="file" accept="image/*" style="display:none">
          </div>

          <div class="group" style="margin-left:auto">
            <button class="btn small" id="undoBtn">Undo</button>
            <button class="btn small" id="redoBtn">Redo</button>
          </div>
        </div>
      </div>

      <!-- Workspace -->
      <div class="workspace" role="main">
        <div class="paper-wrap">
          <div class="paper" id="paper">
            <div id="editor" contenteditable="true" spellcheck="true" aria-multiline="true">
              <h2 style="margin-top:0">Untitled document</h2>
              <p>Start typing here — Otávio Type mimics Google Docs layout and keeps the refined dark glass UI around the workspace.</p>
            </div>
          </div>
        </div>
      </div>

      <div class="bottom-bar">
        <div class="muted">Simple, elegant online editor — works fully in your browser.</div>
        <div class="muted">Page: <select id="pageFormat" style="margin-left:8px"><option value="a4">A4</option><option value="letter">Letter</option></select></div>
      </div>
    </div>
  </div>

<script>
(async function(){
  const { jsPDF } = window.jspdf;

  // elements
  const editor = document.getElementById('editor');
  const docTitleDisplay = document.getElementById('docTitleDisplay');
  const fontFamily = document.getElementById('fontFamily');
  const fontSize = document.getElementById('fontSize');
  const colorPicker = document.getElementById('colorPicker');
  const boldBtn = document.getElementById('boldBtn');
  const italicBtn = document.getElementById('italicBtn');
  const underlineBtn = document.getElementById('underlineBtn');
  const strikeBtn = document.getElementById('strikeBtn');
  const leftAlign = document.getElementById('leftAlign');
  const centerAlign = document.getElementById('centerAlign');
  const rightAlign = document.getElementById('rightAlign');
  const justifyAlign = document.getElementById('justifyAlign');
  const bulletList = document.getElementById('bulletList');
  const numberList = document.getElementById('numberList');
  const indent = document.getElementById('indent');
  const outdent = document.getElementById('outdent');
  const linkBtn = document.getElementById('linkBtn');
  const emailBtn = document.getElementById('emailBtn');
  const imageBtn = document.getElementById('imageBtn');
  const imageInput = document.getElementById('imageInput');
  const openBtn = document.getElementById('openBtn');
  const fileOpen = document.getElementById('fileOpen');
  const saveTxt = document.getElementById('saveTxt');
  const saveDocx = document.getElementById('saveDocx');
  const saveOdt = document.getElementById('saveOdt');
  const exportPdf = document.getElementById('exportPdf');
  const printBtn = document.getElementById('printBtn');
  const undoBtn = document.getElementById('undoBtn');
  const redoBtn = document.getElementById('redoBtn');
  const imageFileInput = document.getElementById('imageInput');

  // basic exec wrapper
  function exec(cmd, value=null){ document.execCommand(cmd, false, value); editor.focus(); }

  // formatting bindings
  boldBtn.addEventListener('click', ()=> exec('bold'));
  italicBtn.addEventListener('click', ()=> exec('italic'));
  underlineBtn.addEventListener('click', ()=> exec('underline'));
  strikeBtn.addEventListener('click', ()=> exec('strikeThrough'));
  leftAlign.addEventListener('click', ()=> exec('justifyLeft'));
  centerAlign.addEventListener('click', ()=> exec('justifyCenter'));
  rightAlign.addEventListener('click', ()=> exec('justifyRight'));
  justifyAlign.addEventListener('click', ()=> exec('justifyFull'));
  bulletList.addEventListener('click', ()=> exec('insertUnorderedList'));
  numberList.addEventListener('click', ()=> exec('insertOrderedList'));
  indent.addEventListener('click', ()=> exec('indent'));
  outdent.addEventListener('click', ()=> exec('outdent'));
  undoBtn.addEventListener('click', ()=> exec('undo'));
  redoBtn.addEventListener('click', ()=> exec('redo'));

  linkBtn.addEventListener('click', ()=>{
    const url = prompt('Insert URL (include https://):','https://');
    if(url) exec('createLink', url);
  });
  emailBtn.addEventListener('click', ()=>{
    const email = prompt('Insert email address:','example@example.com');
    if(email) exec('createLink', 'mailto:' + email);
  });

  // font family/size and color application for selection
  function applyStyleToSelection(styleProp, value){
    const sel = window.getSelection();
    if (!sel.rangeCount) return;
    const range = sel.getRangeAt(0);
    if (range.collapsed) return; // keep it simple for collapsed
    const wrapper = document.createElement('span');
    wrapper.style[styleProp] = value;
    wrapper.appendChild(range.extractContents());
    range.insertNode(wrapper);
    sel.removeAllRanges();
    const newRange = document.createRange();
    newRange.selectNodeContents(wrapper);
    sel.addRange(newRange);
  }
  colorPicker.addEventListener('input', ()=> applyStyleToSelection('color', colorPicker.value));
  fontFamily.addEventListener('change', ()=> applyStyleToSelection('fontFamily', fontFamily.value));
  fontSize.addEventListener('change', ()=> applyStyleToSelection('fontSize', fontSize.value + 'pt'));

  // image insertion + resizer
  imageBtn.addEventListener('click', ()=> imageFileInput.click());
  imageFileInput.addEventListener('change', (e)=>{
    const f = e.target.files && e.target.files[0];
    if (!f) return;
    const r = new FileReader();
    r.onload = ()=> insertResizableImage(r.result);
    r.readAsDataURL(f);
    e.target.value = '';
  });

  function insertResizableImage(dataUrl){
    const wrapper = document.createElement('span');
    wrapper.className = 'resizable';
    wrapper.contentEditable = 'false';
    const img = document.createElement('img');
    img.src = dataUrl; img.alt = 'Image'; img.draggable = false; img.style.maxWidth = '100%'; img.style.height = 'auto';
    const handle = document.createElement('span'); handle.className = 'resizer-handle';
    wrapper.appendChild(img); wrapper.appendChild(handle);

    const sel = window.getSelection();
    if (!sel.rangeCount) { editor.appendChild(wrapper); }
    else {
      const range = sel.getRangeAt(0);
      range.deleteContents();
      range.insertNode(wrapper);
      range.setStartAfter(wrapper); range.collapse(true);
      sel.removeAllRanges(); sel.addRange(range);
    }
    attachResize(handle, img, wrapper);
  }

  function attachResize(handle, img, wrapper){
    let startX, startW, startH;
    function onPointerDown(e){
      e.preventDefault();
      startX = e.clientX;
      const rect = img.getBoundingClientRect();
      startW = rect.width; startH = rect.height;
      document.addEventListener('pointermove', onPointerMove);
      document.addEventListener('pointerup', onPointerUp);
    }
    function onPointerMove(e){
      const dx = e.clientX - startX;
      const newW = Math.max(40, startW + dx);
      const ratio = startH/startW;
      img.style.width = newW + 'px';
      img.style.height = (newW * ratio) + 'px';
      wrapper.style.border = '1px dashed rgba(150,150,150,0.4)';
    }
    function onPointerUp(){
      document.removeEventListener('pointermove', onPointerMove);
      document.removeEventListener('pointerup', onPointerUp);
      wrapper.style.border = '1px dashed transparent';
    }
    handle.addEventListener('pointerdown', onPointerDown);
    img.addEventListener('click', ()=> {
      const range = document.createRange();
      range.setStartAfter(wrapper); range.collapse(true);
      const sel = window.getSelection(); sel.removeAllRanges(); sel.addRange(range);
    });
  }

  // opening files
  openBtn.addEventListener('click', ()=> fileOpen.click());
  fileOpen.addEventListener('change', async (e)=>{
    const f = e.target.files && e.target.files[0]; if (!f) return;
    const name = f.name.toLowerCase();
    if (name.endsWith('.txt')){
      const txt = await f.text(); editor.innerText = txt;
    } else if (name.endsWith('.docx')){
      const arrayBuffer = await f.arrayBuffer();
      try { const result = await window.mammoth.convertToHtml({arrayBuffer: arrayBuffer}); editor.innerHTML = result.value; }
      catch(err){ alert('Failed to open DOCX: ' + err.message); }
    } else if (name.endsWith('.pdf')){
      await importPdfAsImages(f);
    } else { alert('Unsupported file type: ' + f.name); }
    fileOpen.value = '';
  });

  // pdf -> images (via pdf.js)
  async function importPdfAsImages(file){
    const arrayBuffer = await file.arrayBuffer();
    const loadingTask = window.pdfjsLib.getDocument({data: arrayBuffer});
    try {
      const pdf = await loadingTask.promise;
      for (let i=1;i<=pdf.numPages;i++){
        const page = await pdf.getPage(i);
        const viewport = page.getViewport({scale: 2});
        const canvas = document.createElement('canvas');
        canvas.width = viewport.width; canvas.height = viewport.height;
        const ctx = canvas.getContext('2d');
        await page.render({canvasContext: ctx, viewport: viewport}).promise;
        const dataUrl = canvas.toDataURL('image/png');
        insertResizableImage(dataUrl);
        // add visual page break
        const hr = document.createElement('hr');
        hr.style.border = 'none'; hr.style.borderTop = '1px dashed rgba(0,0,0,0.08)'; hr.style.margin = '18px 0';
        editor.appendChild(hr);
      }
    } catch(err){ alert('Failed to import PDF: ' + err.message); }
  }

  // save as TXT
  function saveAsTxt(){
    const txt = editor.innerText || ''; const blob = new Blob([txt], {type:'text/plain;charset=utf-8'});
    const name = (docTitleDisplay.innerText.trim() || 'otavio-pdf') + '.txt'; downloadBlob(blob, name);
  }
  document.getElementById('saveTxt').addEventListener('click', saveAsTxt);

  // save as DOCX (html-docx-js)
  function saveAsDocx(){
    const html = '<!DOCTYPE html><html><head><meta charset="utf-8"></head><body>' + editor.innerHTML + '</body></html>';
    try { const converted = window.htmlDocx.asBlob(html); const name = (docTitleDisplay.innerText.trim() || 'otavio-pdf') + '.docx'; downloadBlob(converted, name); }
    catch(err){ alert('DOCX export failed: ' + err.message); }
  }
  document.getElementById('saveDocx').addEventListener('click', saveAsDocx);

  // save as ODT fallback (HTML inside)
  function saveAsOdt(){
    const html = '<!doctype html><html><head><meta charset="utf-8"></head><body>' + editor.innerHTML + '</body></html>';
    const blob = new Blob([html], {type:'application/vnd.oasis.opendocument.text'});
    const name = (docTitleDisplay.innerText.trim() || 'otavio-pdf') + '.odt'; downloadBlob(blob, name);
  }
  document.getElementById('saveOdt').addEventListener('click', saveAsOdt);

  function downloadBlob(blob, filename){ const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = filename; document.body.appendChild(a); a.click(); setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); },150); }

  // Export to PDF WITHOUT watermark/footer
  async function exportToPdf(filenameOverride){
    const filename = (docTitleDisplay.innerText.trim() || 'otavio-pdf') + '.pdf';
    const finalName = filenameOverride || filename.replace(/[^\w\-\.\s]/g,'_');
    const margin = 15;
    const format = document.getElementById('pageFormat').value || 'a4';
    const doc = new jsPDF({ unit: 'mm', format: format, putOnlyUsedFonts:true, floatPrecision: 16 });

    const paper = document.getElementById('paper');
    const clone = paper.cloneNode(true);
    clone.classList.add('pdf-clone');

    // Normalize colors (force black text) and remove filters
    (function normalize(node){
      if (node.nodeType === Node.ELEMENT_NODE){
        node.style.color = 'black';
        node.style.background = 'transparent';
        node.style.filter = 'none';
        node.style.backdropFilter = 'none';
        // recursively normalize children
        for (let i=0;i<node.childNodes.length;i++) normalize(node.childNodes[i]);
      }
    })(clone);

    clone.style.position = 'fixed';
    clone.style.left = '-9999px';
    clone.style.top = '0';
    clone.style.width = (doc.internal.pageSize.getWidth() - margin*2) + 'mm';
    document.body.appendChild(clone);

    try {
      await new Promise((resolve, reject) => {
        doc.html(clone, {
          x: margin, y: margin,
          html2canvas: { scale: Math.max(1, window.devicePixelRatio || 1), useCORS:true, allowTaint:true },
          callback: function (docArg) {
            try {
              // no footer added here — export will contain only the document content
              docArg.save(finalName);
              resolve();
            } catch(e){ reject(e); }
          },
          margin: [margin, margin, margin, margin]
        });
      });
    } catch (err) { console.error(err); alert('PDF export failed: ' + err.message); }
    finally { document.body.removeChild(clone); }
  }
  exportPdf.addEventListener('click', ()=> exportToPdf());

  // Print: open new window with normalized clone, call print
  function printDocument(){
    const paper = document.getElementById('paper');
    const clone = paper.cloneNode(true);
    // normalize colors to ensure readable print
    (function normalize(node){
      if (node.nodeType === Node.ELEMENT_NODE){
        node.style.color = 'black';
        node.style.background = 'transparent';
        node.style.filter = 'none';
        node.style.backdropFilter = 'none';
        for (let i=0;i<node.childNodes.length;i++) normalize(node.childNodes[i]);
      }
    })(clone);

    const w = window.open('', '_blank', 'noopener');
    if (!w) { alert('Unable to open print window. Check popup blocker.'); return; }
    const docHtml = `
      <html><head><title>${docTitleDisplay.innerText || 'Document'}</title>
      <meta charset="utf-8"/>
      <style>
        body{margin:0;padding:18mm;font-family:"Times New Roman", Times, serif;color:#000}
        img{max-width:100%;height:auto;display:block;margin:8px 0}
      </style>
      </head><body>${clone.innerHTML}</body></html>
    `;
    w.document.open();
    w.document.write(docHtml);
    w.document.close();
    w.focus();
    // give browser a moment to layout
    setTimeout(()=>{ w.print(); /* don't auto close to let user cancel if needed */ }, 500);
  }
  printBtn.addEventListener('click', printDocument);

  // Undo/redo keyboard and save shortcuts
  document.addEventListener('keydown', (e)=>{
    if ((e.ctrlKey||e.metaKey) && e.key.toLowerCase() === 's'){ e.preventDefault(); exportToPdf(); }
    if ((e.ctrlKey||e.metaKey) && e.key.toLowerCase() === 'b'){ e.preventDefault(); exec('bold'); }
    if ((e.ctrlKey||e.metaKey) && e.key.toLowerCase() === 'i'){ e.preventDefault(); exec('italic'); }
  });

  // Normalize images inserted by external imports: wrap with resizer
  const mo = new MutationObserver((mutations)=>{
    for (const m of mutations){
      for (const node of m.addedNodes){
        if (node.nodeType === 1){
          const imgs = node.tagName === 'IMG' ? [node] : (node.querySelectorAll ? node.querySelectorAll('img') : []);
          imgs.forEach(img => {
            if (!img.parentElement.classList.contains('resizable')){
              const wrapper = document.createElement('span'); wrapper.className='resizable'; wrapper.contentEditable='false';
              const handle = document.createElement('span'); handle.className='resizer-handle';
              img.replaceWith(wrapper); wrapper.appendChild(img); wrapper.appendChild(handle);
              attachResize(handle, img, wrapper);
            }
          });
        }
      }
    }
  });
  mo.observe(editor, { childList:true, subtree:true });

  // attachResize reused
  function attachResize(handle, img, wrapper){
    let startX, startW, startH;
    function onPointerDown(e){
      e.preventDefault();
      startX = e.clientX;
      startW = img.getBoundingClientRect().width;
      startH = img.getBoundingClientRect().height;
      document.addEventListener('pointermove', onPointerMove);
      document.addEventListener('pointerup', onPointerUp);
    }
    function onPointerMove(e){
      const dx = e.clientX - startX;
      const newW = Math.max(40, startW + dx);
      const ratio = startH/startW;
      img.style.width = newW + 'px';
      img.style.height = (newW * ratio) + 'px';
      wrapper.style.border = '1px dashed rgba(150,150,150,0.4)';
    }
    function onPointerUp(){
      document.removeEventListener('pointermove', onPointerMove);
      document.removeEventListener('pointerup', onPointerUp);
      wrapper.style.border = '1px dashed transparent';
    }
    handle.addEventListener('pointerdown', onPointerDown);
    img.addEventListener('click', ()=> {
      const range = document.createRange();
      range.setStartAfter(wrapper); range.collapse(true);
      const sel = window.getSelection(); sel.removeAllRanges(); sel.addRange(range);
    });
  }

  // expose basic API
  window.otavioType = { exportToPdf, printDocument, saveAsTxt, saveAsDocx, saveAsOdt: saveAsOdt };
})();
</script>
</body>
</html>
